---
import Layout from '../../../layouts/Layout.astro';
import { marcas } from '../../../lib/mangos';
import Galeria from '../../../components/Galeria.astro';

// getStaticPaths para generar las rutas estáticas
export function getStaticPaths() {
  const paths = [];

  marcas.forEach((marca) => {
    marca.productos.forEach((producto) => {
      console.log('Marca:', marca.slug, 'Producto:', producto.slug);
      paths.push({
        params: {
          grupo: marca.slug,
          producto: producto.slug,
        },
      });
    });
  });

  return {
    paths, // Devolvemos el array de rutas
    fallback: false, // Si la ruta no existe, mostramos un 404
  };
}

// Obtener los parámetros de la URL
const { grupo, producto } = Astro.params;

// Buscar la marca y el producto correspondientes
const miMarca = marcas.find((m) => m.slug === grupo);
const miProducto = miMarca?.productos.find((p) => p.slug === producto);

// Verificación para evitar errores si no se encuentra el producto
if (!miProducto) {
  console.error(`No se encontró el producto: ${producto} en la marca: ${grupo}`);
}
---

<Layout title="Mango">
  <main class="sm:w-4/5 m-auto flex sm:flex-row flex-col justify-center items-center mt-10 text-white">
    <section class="w-full sm:w-1/2 flex flex-col justify-center items-center sm:order-1 order-2 mb-10">
      {miProducto?.fotos?.length > 0 ? (
        <>
          <Galeria img1={miProducto.fotos[0]} img2={miProducto.fotos[1]} img3={miProducto.fotos[2]} nombre1={miProducto.sabores[0]} nombre2={miProducto.sabores[1]} nombre3={miProducto.sabores[2]} />
        </>
      ) : (
        <p>No hay imágenes disponibles</p>
      )}
    </section>
    
    <section class="w-4/5 sm:w-1/2 sm:order-2 order-1">
      <article>
        {miProducto ? (
          <>
            <div>
              <h1 class="font-pepsi-compress text-white text-6xl my-4">{miProducto.titulo}</h1>
              <p>{miProducto.detalles}</p>
            </div>
            <ul class="mb-2 mt-6">
              <li><span class="font-bold">Calories:</span> {miProducto.calorias || 'No disponible'}</li>
              <li><span class="font-bold">Sweetener System:</span> {miProducto.sweetnerSystem || 'No disponible'}</li>

              {miProducto.info && miProducto.info.length > 0 && (
                <>
                  <li><span class="font-bold">Additional Info:</span></li>
                  {miProducto.info.map((info, index) => (
                    <li key={index}>{info}</li>
                  ))}
                </>
              )}
            </ul>
            <div class="flex justify-start gap-4 my-6">
              {miProducto.paises && miProducto.paises.length > 0 ? (
                <>
                  {miProducto.paises.map((pais, index) => {
                    console.log('País:', pais);  // Se ha movido el console.log fuera del JSX
                    return (
                      <img key={index} class="h-12" src={`/images/${pais}.webp`} alt={`Bandera de ${pais}`} />
                    );
                  })}
                </>
              ) : (
                <p>No hay países disponibles</p>
              )}
            </div>
          </>
        ) : (
          <p>Loading...</p>
        )}
      </article>
    </section>
  </main>
</Layout>
